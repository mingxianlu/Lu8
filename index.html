<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<style>
:root{
  --circle-size: 60px;
  --circle-gap: 4px;
  --circle-border: 2px;
  --cols: 4;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK TC", Arial;
  background:#fcfcfc;
}

.page{
  display:flex;
  gap:10px;
  padding:10px;
  align-items:flex-start;
  position: relative;
}

/* 左1 黑鍵 + 四圈 */
.left1{
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  height: calc(var(--circle-size)*10 + var(--circle-gap)*9 + 20px);
  border: 3px solid #000;
  position: relative;
  background:#000;
  padding-bottom: 10px; /* 調整為只留底部空間 */
}

/* 頂部 GO 按鈕 (白圈切換功能) */
.switch-key{
  width: calc(var(--circle-size));
  height: calc(var(--circle-size));
  background:#fff;
  color:#fff; /* 文字改為黑色 */
  border-radius:50%;
  border:2px solid #000;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:700;
  font-size:28px;
  user-select:none;
  cursor:pointer;
  margin: 2px 2px 10px 2px; /* 位於頂部，周圍間距 */
}

/* 四圈固定, 由下至上排列, 根據選中的號碼動態生成 */
.big-circles{
  display:flex;
  flex-direction: column-reverse; /* 由下至上 */
  gap:4px;
  align-items:center;
  position: absolute;
  bottom: 10px; /* 讓最底部的號碼與 '09' 對齊 */
  left: 2px;
  padding-left: 2px;
}

.big-circle{
  width: var(--circle-size);
  height: var(--circle-size);
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:700;
  font-size:32px;
  color:#fff;
  cursor:pointer;
}

.big-circle.red{background:red;}
.big-circle.blue{background:blue;}
.big-circle.green{background:green;}
.big-circle.purple{background:purple;}

/* 左2 號碼圈 */
.left2{
  box-sizing:border-box;
  padding:6px;
  border:2px solid #000;
  display:grid;
  grid-template-columns: repeat(var(--cols), calc(var(--circle-size)));
  grid-auto-rows: calc(var(--circle-size));
  gap: var(--circle-gap);
  width: calc(var(--cols) * var(--circle-size) + (var(--cols)-1)*var(--circle-gap) + 12px);
  /* 預設隱藏 */
  display:none; 
}

.num{
  width: calc(var(--circle-size));
  height: calc(var(--circle-size));
  border-radius:50%;
  border: var(--circle-border) solid #000;
  background:#fff;
  color:#000;
  font-weight:700;
  font-size:28px;
  display:flex;
  justify-content:center;
  align-items:center;
  user-select:none;
  cursor:pointer;
}

.num.selected{
  color:#fff;
  font-weight:700;
}
.num.red.selected{background:red; border-color:red;}
.num.blue.selected{background:blue; border-color:blue;}
.num.green.selected{background:green; border-color:green;}
.num.purple.selected{background:purple; border-color:purple;}

/* 黑色清除實心圈 (00位置) - 新樣式 */
.num.clear-key {
  background-color: #000; /* 黑實心 */
  color: #fff; /* 文字隱藏 */
  border: 2px solid #000; /* 白邊 */
  pointer-events: auto; /* 允許點擊 */
}

/* 左3 表格 */
.left3{
  border:2px solid #000;
  width: calc(var(--cols)*var(--circle-size) + (var(--cols)-1)*var(--circle-gap) + 12px);
  padding:2px;
  background:#fff;
  height:650px;
  overflow-y:auto;
  position: relative;
}

th, td {
  border: 1px solid #ccc;
  padding: 2px;
  text-align: center;
}

thead th {
  position: sticky;
  top: 0;
  background: #000;
  z-index: 10;
  color:#fff;
}

.circle-cell {
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:50%;
  width: 24px;
  height: 24px;
  color:#fff;
  font-weight:700;
  margin: 0 auto; /* 置中 */
}

.circle-cell.red{background:red;}
.circle-cell.blue{background:blue;}
.circle-cell.green{background:green;}
.circle-cell.purple{background:purple;}
</style>
</head>
<body>

<div class="page" id="page">

  <div class="left1">
    <div class="switch-key" id="goBtn"></div>

    <div class="big-circles" id="bigCirclesContainer">
      
    </div>
  </div>

  <div class="left2" id="left2"></div>

  <div class="left3" id="left3">
    <table>
      <thead>
        <tr><th>日期</th><th>星期</th><th>號1</th><th>號2</th><th>號3</th><th>號4</th><th>號5</th></tr>
      </thead>
      <tbody>
<tr><td>2025/11/07</td><td>五</td><td>22</td><td>27</td><td>30</td><td>32</td><td>37</td></tr>   
<tr><td>2025/11/06</td><td>四</td><td>07</td><td>24</td><td>28</td><td>31</td><td>32</td></tr>
<tr><td>2025/11/05</td><td>三</td><td>11</td><td>14</td><td>15</td><td>27</td><td>39</td></tr>	
</tbody>
    </table>
  </div>

</div>

<script>
const left2 = document.getElementById('left2');
const bigCirclesContainer = document.getElementById('bigCirclesContainer');
const goBtn = document.getElementById('goBtn');
const left3 = document.getElementById('left3');
const colors = ['red','blue','green','purple'];  
let selected = []; // 儲存已選號碼 {num, color}
let isLeft2Visible = false; 
let clearBtnElement; // 用於存放黑圈清除鍵的 DOM 元素

// 建立號碼盤
// 創建 黑圈清除鍵 (原 00 位置)
clearBtnElement = document.createElement('div');
clearBtnElement.classList.add('num', 'clear-key');
clearBtnElement.dataset.num = '00';
left2.appendChild(clearBtnElement);

// 創建 01 到 39 的號碼
for(let row=0;row<10;row++){
  for(let col=0;col<4;col++){
    let n = row + col*10;
    if(n===0||n>39) continue;
    const div = document.createElement('div');
    div.classList.add('num');
    div.dataset.num=n.toString().padStart(2,'0');
    div.textContent=n.toString().padStart(2,'0');
    left2.appendChild(div);
  }
}

/**
 * 根據 current selected 更新所有相關 UI
 */
function updateCircles(){
  // 排序 selected 確保在四圈和表格中的顯示順序一致
  selected.sort((a, b) => parseInt(a.num) - parseInt(b.num)); 

  // 1. 動態創建四圈的號碼顯示
  bigCirclesContainer.innerHTML = ''; 
  selected.forEach(s => {
    const c = document.createElement('div');
    c.classList.add('big-circle', s.color);
    c.textContent = s.num;
    bigCirclesContainer.appendChild(c);
  });
  
  // 2. 清空 left2 號碼盤的舊顏色狀態
  left2.querySelectorAll('.num').forEach(n=>{
    n.classList.remove('selected','red','blue','green','purple');
  });

  // 3. 處理表格顯示
  left3.querySelectorAll('tbody tr').forEach(tr=>{
    const rowCells = Array.from(tr.cells).slice(2,7);
    const rowNums = rowCells.map(td=>td.textContent.replace(/<.*?>/g, '').trim()); 

    // 先清除所有標記
    rowCells.forEach(td => {
      const old = td.querySelector('.circle-cell');
      if(old) td.textContent = old.textContent; // 恢復成純數字
    });

    const matchCount = selected.filter(s=>rowNums.includes(s.num)).length;

    // 判斷：當該行有 2 個或以上已選號碼時，才進行標記
    if(matchCount >= 2){
      selected.forEach(s=>{
        const idx = rowNums.indexOf(s.num);
        if(idx >= 0){
          rowCells[idx].innerHTML = `<div class="circle-cell ${s.color}">${s.num}</div>`;
        }
      });
    }
  });

  // 4. 畫出 left2 號碼盤的實心圈
  selected.forEach((s)=>{
    const left2Num = left2.querySelector(`.num[data-num="${s.num}"]`);
    if(left2Num){
      left2Num.classList.add('selected', s.color);
    }
  });
  
  // 確保清除鍵的樣式
  clearBtnElement.classList.add('clear-key');
}

// ============== 事件監聽 ==============

// 白圈切換功能 (GO 按鈕)
  goBtn.addEventListener('click', ()=>{
  isLeft2Visible = !isLeft2Visible;
  
  if(isLeft2Visible){
    left2.style.display = 'grid'; // 顯示號碼盤
  } else {
    left2.style.display = 'none'; // 隱藏號碼盤
  }
});

// 黑圈清除功能 (●) - 點擊 00 位置
clearBtnElement.addEventListener('click', ()=>{
  selected = []; // 清空所有選中的號碼
  updateCircles();
});


// 號碼選擇 (01~39 和表格)
function handleNumberSelection(num) {
  const idx = selected.findIndex(s => s.num === num);

  if (idx >= 0) {
    // 取消選擇
    selected.splice(idx, 1);
  } else if (selected.length < 4) {
    // 選擇號碼 (最多4個)
    const usedColors = selected.map(s => s.color);
    const nextColor = colors.find(c => !usedColors.includes(c));

    if (nextColor) {
      selected.push({ num, color: nextColor });
    }
  }
  updateCircles();
}

// 監聽 01~39 號碼盤的點擊
left2.addEventListener('click', e => {
  const el = e.target.closest('.num');
  if (el && !el.classList.contains('clear-key')) { // 確保不是點擊清除鍵
    handleNumberSelection(el.dataset.num);
  }
});

// 監聽表格中的號碼點擊
left3.addEventListener('click', e => {
  const cell = e.target.closest('td');
  if (cell && cell.cellIndex >= 2 && cell.cellIndex <= 6) { // 確保點擊的是號碼列
    const num = cell.textContent.trim(); // 獲取表格中的數字
    if (!isNaN(num) && num !== '') { // 確保是有效數字
      handleNumberSelection(num.padStart(2, '0')); // 轉換為兩位數字字符串
    }
  }
});


// 初始顯示
updateCircles();

</script>

</body>
</html>
